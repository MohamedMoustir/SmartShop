{
  "version": "1.0",
  "records": [
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/presontation/controller/ProductController.java",
      "timestamp": 1764231593724,
      "startOffset": 48,
      "endOffset": 1801,
      "codeContent": "import com.smartshop.application.service.ProductServise;\nimport com.smartshop.presontation.dto.Request.ProductRequest;\nimport com.smartshop.presontation.dto.Response.ProductResponse;\nimport jakarta.validation.Valid;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/product\")\n@RequiredArgsConstructor\npublic class ProductController {\n\n    private final ProductServise productServise;\n\n    @PostMapping\n    public ResponseEntity\u003cProductResponse\u003e addProduct(@RequestBody @Valid ProductRequest request) {\n        ProductResponse response \u003d productServise.createProduct(request);\n        return new ResponseEntity\u003c\u003e(response, HttpStatus.CREATED);\n    }\n\n\n    @GetMapping\n    public ResponseEntity\u003cList\u003cProductResponse\u003e\u003e getProducts(\n            @RequestParam(defaultValue \u003d \"0\") int page,\n            @RequestParam(defaultValue \u003d \"10\") int size,\n            @RequestParam(required \u003d false) String search\n    ) {\n        List\u003cProductResponse\u003e products \u003d productServise.getAllProduct(search, page, size);\n        return ResponseEntity.ok(products);\n    }\n\n    @PutMapping(\"/{id}\")\n    public ResponseEntity\u003cProductResponse\u003e updateProduct(\n            @PathVariable Long id,\n            @RequestBody @Valid ProductRequest request\n    ) {\n        ProductResponse response \u003d productServise.updateProduct(id, request);\n        return ResponseEntity.ok(response);\n    }\n\n    @DeleteMapping(\"/{id}\")\n    public ResponseEntity\u003cVoid\u003e deleteProduct(@PathVariable Long id) {\n        productServise.deleteProduct(id);\n        return ResponseEntity.noContent().build();\n    }\n}",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 50
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/application/mapper/ProductMapper.java",
      "timestamp": 1764231593730,
      "startOffset": 64,
      "endOffset": 930,
      "codeContent": "domain.model.Product;\nimport com.smartshop.presontation.dto.Request.ProductRequest;\nimport com.smartshop.presontation.dto.Response.ProductResponse;\n\npublic class ProductMapper {\n\n    public static Product toEntity(ProductRequest product) {\n        if (product \u003d\u003d null) return null;\n\n        return Product.builder()\n                .nom(product.getNom())\n                .prixUnitaire(product.getPrixUnitaire())\n                .stockDisponible(product.getStockDisponible())\n                .build();\n    }\n\n    public static ProductResponse toResponse(Product dto) {\n        if (dto \u003d\u003d null) return null;\n\n        return ProductResponse.builder()\n                .id(dto.getId())\n                .nom(dto.getNom())\n                .prixUnitaire(dto.getPrixUnitaire())\n                .stockDisponible(dto.getStockDisponible())\n                .deleted(dto.isDeleted",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 25
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/presontation/config/AuthInterceptor.java",
      "timestamp": 1764231593755,
      "startOffset": 733,
      "endOffset": 1603,
      "codeContent": "\n        HttpSession session \u003drequest.getSession(false);\n        if(session \u003d\u003d null || session.getAttribute(USER_ID_KEY) \u003d\u003d null){\n            throw new UnauthorizedException(\"Session expirée ou non authentifié. Veuillez vous connecter.\");\n        }\n\n        String userRle \u003d session.getAttribute(USER_ROLE_KEY).toString();\n        String requestPath \u003d request.getRequestURI();\n\n        if(requestPath.startsWith(\"/api/client\") || requestPath.startsWith(\"/api/product\") || requestPath.startsWith(\"/api/commandes\")){\n            if(\"CLIENT\".equals(userRle) \u0026\u0026 !request.getMethod().equalsIgnoreCase(\"GET\")){\n                throw new ForbiddenException(\"Accès refusé. Seul l\u0027ADMIN peut créer, modifier ou supprimer ces ressources.\");\n            }\n            if(\"CLIENT\".equals(userRle) \u0026\u0026 requestPath.startsWith(\"/api/client\")\u0026\u0026 request.getMethod().equalsIgnoreCase(\"GET",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 14
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/presontation/config/GlobalExceptionHandler.java",
      "timestamp": 1764231593759,
      "startOffset": 147,
      "endOffset": 3071,
      "codeContent": "InvalidOrderStateException;\nimport com.smartshop.domain.Excption.ResourceNotFoundException;\nimport jakarta.servlet.http.HttpServletRequest;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.MethodArgumentNotValidException;\nimport org.springframework.web.bind.annotation.ControllerAdvice;\nimport org.springframework.web.bind.annotation.ExceptionHandler;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport java.util.HashMap;\nimport java.util.LinkedHashMap;\nimport java.util.Map;\n\n@ControllerAdvice\npublic class GlobalExceptionHandler {\n    private static final Logger logger \u003d LoggerFactory.getLogger(GlobalExceptionHandler.class);\n\n    @ExceptionHandler(InvalidCredentialsException.class)\n    public ResponseEntity\u003cMap\u003cString, String\u003e\u003e handleInvalidCredentialsErrors(InvalidCredentialsException ex, HttpServletRequest request) {\n        Map\u003cString, String\u003e errorBody \u003d new LinkedHashMap\u003c\u003e();\n        errorBody.put(\"status\", String.valueOf(HttpStatus.UNAUTHORIZED.value()));\n        errorBody.put(\"error\", \"UNAUTHORIZED\");\n        errorBody.put(\"message\", ex.getMessage());\n        errorBody.put(\"path\", request.getRequestURI());\n\n        return new ResponseEntity\u003c\u003e(errorBody,HttpStatus.UNAUTHORIZED);\n    }\n    @ExceptionHandler(MethodArgumentNotValidException.class)\n    public ResponseEntity\u003c?\u003e handleValidationExceptions(\n            MethodArgumentNotValidException ex, HttpServletRequest request) {\n\n        Map\u003cString, String\u003e errors \u003d new HashMap\u003c\u003e();\n        ex.getBindingResult().getFieldErrors().forEach(error -\u003e\n                errors.put(error.getField(), error.getDefaultMessage())\n        );\n                errors.put(\"status\", String.valueOf( HttpStatus.BAD_REQUEST.value()));\n                errors.put(\"error\", errors.toString());\n                errors.put(\"message\", ex.getMessage());\n                errors.put(\"path\", request.getRequestURI());\n\n        return new ResponseEntity\u003c\u003e(errors,HttpStatus.BAD_REQUEST);\n\n    }\n    \n    @ExceptionHandler(ResourceNotFoundException.class)\n    public ResponseEntity\u003c?\u003e handleNotFoundException(\n            ResourceNotFoundException ex, HttpServletRequest request) {\n        Map\u003cString, String\u003e errors \u003d new HashMap\u003c\u003e();\n        errors.put(\"status\", String.valueOf( HttpStatus.NOT_FOUND.value()));\n        errors.put(\"error\", \"NOT_FOUND\");\n        errors.put(\"message\", ex.getMessage());\n        errors.put(\"path\", request.getRequestURI());\n        return new ResponseEntity\u003c\u003e(errors,HttpStatus.BAD_REQUEST);\n    }\n\n    @ExceptionHandler(InvalidOrderStateException.class)\n    public ResponseEntity\u003cMap\u003cString, String\u003e\u003e handleInvalidState(InvalidOrderStateException ex) {\n        Map\u003cString, String\u003e error \u003d new HashMap\u003c\u003e();\n        error.put(\"error\", \"CONFLICT\");\n        error.put(\"message\", ex.getMessage());\n        return new ResponseEntity\u003c\u003e(error, HttpStatus.CONFLIC",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 63
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/presontation/dto/Request/ProductRequest.java",
      "timestamp": 1764231593765,
      "startOffset": 49,
      "endOffset": 756,
      "codeContent": "import jakarta.validation.constraints.Min;\nimport jakarta.validation.constraints.NotBlank;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\npublic class ProductRequest {\n\n    @NotBlank(message \u003d \"Le nom est obligatoire\")\n    private String nom;\n\n    @NotNull(message \u003d \"Le prix est obligatoire\")\n    @Min(value \u003d 0, message \u003d \"Le prix doit être positif\")\n    private Double prixUnitaire;\n\n    @NotNull(message \u003d \"Le stock est obligatoire\")\n    @Min(value \u003d 0, message \u003d \"Le stock ne peut pas être négatif\")\n    private Integer stockDisponible;\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 25
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/application/service/ProductServise.java",
      "timestamp": 1764231593780,
      "startOffset": 44,
      "endOffset": 3035,
      "codeContent": "import com.smartshop.application.mapper.ProductMapper;\nimport com.smartshop.domain.Excption.InvalidCredentialsException;\nimport com.smartshop.domain.model.Product;\nimport com.smartshop.infrastructuer.Repository.CommandeRepository;\nimport com.smartshop.infrastructuer.Repository.OrderItemRepository;\nimport com.smartshop.infrastructuer.Repository.ProductRepository;\nimport com.smartshop.presontation.dto.Request.ProductRequest;\nimport com.smartshop.presontation.dto.Response.ProductResponse;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\nimport java.util.stream.Collectors;\n\nimport static com.smartshop.application.mapper.ProductMapper.toResponse;\n\n@Service\n@RequiredArgsConstructor\npublic class ProductServise {\n\n    private final ProductRepository productRepository;\n    private final OrderItemRepository orderItemRepository;\n\n\n    public ProductResponse createProduct(ProductRequest request){\n        Product productEntity \u003d ProductMapper.toEntity(request);\n        Product product \u003d productRepository.save(productEntity);\n        return toResponse(product);\n    }\n\n    public List\u003cProductResponse\u003e getAllProduct(String nom , int page, int size){\n        PageRequest pageable \u003d PageRequest.of(page, size);\n\n        Page\u003cProduct\u003e productPage;\n        if (nom \u003d\u003d null || nom.trim().isEmpty() || \"all\".equalsIgnoreCase(nom)) {\n            productPage \u003d productRepository.findAll(pageable);\n        } else {\n            productPage \u003d productRepository.findByNomContaining(nom, pageable);\n        }\n        return productPage.getContent().stream().map(ProductMapper::toResponse).collect(Collectors.toList());\n\n    }\n\n    public void deleteProduct(Long id){\n        Product product \u003d productRepository.findById(id)\n                .orElseThrow(() -\u003e new IllegalArgumentException(\"Product introuvable avec l\u0027id : \" + id));\n          Boolean existsInOrder \u003d orderItemRepository.existsByProduct_Id(id);\n        if(!existsInOrder){\n            product.setDeleted(true);\n            productRepository.save(product);\n        }else{\n            productRepository.delete(product);\n\n        }\n\n\n    }\n\n    public ProductResponse updateProduct(Long id ,ProductRequest request) {\n        Product product \u003d productRepository.findById(id)\n                .orElseThrow(() -\u003e new RuntimeException(\"Product not found\"));\n        if (request.getNom() \u003d\u003d null || request.getPrixUnitaire() \u003d\u003d null) {\n            throw new IllegalArgumentException(\"Les informations du produit sont incomplètes.\");\n        }\n            product.setNom(request.getNom());\n            product.setPrixUnitaire(request.getPrixUnitaire());\n         if(request.getStockDisponible() !\u003d null) {\n            product.setStockDisponible(request.getStockDisponible());\n        }\n\n        Product product1 \u003d productRepository.save(product);\n        return toResponse(product1);\n    }",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 75
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/presontation/dto/Response/ProductResponse.java",
      "timestamp": 1764231593787,
      "startOffset": 50,
      "endOffset": 391,
      "codeContent": "import lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\npublic class ProductResponse {\n\n    private Long id;\n    private String nom;\n    private Double prixUnitaire;\n    private Integer stockDisponible;\n    private boolean deleted;\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 17
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/domain/model/Commande.java",
      "timestamp": 1764231593798,
      "startOffset": 103,
      "endOffset": 1160,
      "codeContent": "com.smartshop.presontation.dto.Response.OrderItemResponse;\n    import jakarta.persistence.*;\n    import lombok.AllArgsConstructor;\n    import lombok.Builder;\n    import lombok.Data;\n    import lombok.NoArgsConstructor;\n\n    import java.time.LocalDateTime;\n    import java.util.ArrayList;\n    import java.util.List;\n\n    @Entity\n    @Table(name \u003d \"commands\")\n    @Data\n    @Builder\n    @NoArgsConstructor\n    @AllArgsConstructor\n    public class Commande {\n        @Id\n        @GeneratedValue(strategy \u003d GenerationType.IDENTITY)\n        private Long id;\n        @ManyToOne(fetch \u003d FetchType.LAZY)\n        @JoinColumn(name \u003d \"client_id\", nullable \u003d false)\n        private Client client;\n\n        private LocalDateTime date;\n\n        @OneToMany(mappedBy \u003d \"commande\", cascade \u003d CascadeType.ALL, orphanRemoval \u003d true)\n        private List\u003cOrderItem\u003e orderItems \u003d new ArrayList\u003c\u003e();\n\n        private Double sousTotalHT;\n        private Double montantRemise;\n        private Double tva;\n        private Double totalTTC;\n        private Double montantHTApresRemise",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 35
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/infrastructuer/Repository/ProductRepository.java",
      "timestamp": 1764231593805,
      "startOffset": 100,
      "endOffset": 629,
      "codeContent": "com.smartshop.presontation.dto.Response.ProductResponse;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.repository.query.Param;\nimport org.springframework.stereotype.Repository;\n\nimport java.awt.print.Pageable;\n\n@Repository\npublic interface ProductRepository extends JpaRepository\u003cProduct,Long\u003e {\n    Page\u003cProduct\u003e  findByNomContaining(@Param(\"nom\") String nom , PageRequest pageable);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 12
    },
    {
      "filePath": "C:/Users/safiy/Downloads/smartshop-backend/smartshop-backend/src/main/java/com/smartshop/infrastructuer/Repository/OrderItemRepository.java",
      "timestamp": 1764231593809,
      "startOffset": 50,
      "endOffset": 383,
      "codeContent": "import com.smartshop.domain.model.Commande;\nimport com.smartshop.domain.model.OrderItem;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\n@Repository\npublic interface OrderItemRepository  extends JpaRepository\u003cOrderItem,Long\u003e {\n    Boolean existsByProduct_Id(Long id);\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 9
    }
  ],
  "toolStats": {
    "AI Assistant": {
      "usageCount": 10,
      "totalLines": 325
    }
  }
}